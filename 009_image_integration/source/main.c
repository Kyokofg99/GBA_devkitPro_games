#include <string.h>
#include <tonc_video.h>
#include <tonc_input.h>

#include <tonc_types.h>

#include "img/pueblecito_1.h"
#include "img/pueblecito_1.c"
#include "img/prueba.c"



#define brinPalLen 128
const unsigned short brinPal[ 64 ] = {
	0x1485,0x20c7,0x314c,0x35b2,0x3e55,0x312d,0x45cf,0x5ab3,
	0x6b78,0x7fff,0x108d,0x18f6,0x193d,0x25fe,0x1895,0x1cfd,
	0x0dbf,0x0a5e,0x171f,0x20cf,0x1d13,0x1db9,0x265c,0x2aff,
	0x10e9,0x198c,0x22b4,0x279a,0x43ff,0x2562,0x3244,0x3ae3,
	0x3772,0x3779,0x1cc6,0x2526,0x31ea,0x42b2,0x4af6,0x3161,
	0x4621,0x4ea1,0x5f86,0x73f1,0x28c6,0x3929,0x5989,0x7269,
	0x7f51,0x1ca8,0x38ed,0x5572,0x7a15,0x76bd,0x28ee,0x3534,
	0x3d99,0x4e1d,0x2c70,0x2898,0x3d3e,0x421e,0x4a9f,0x5b3f,

};

#define brinTilesLen 32*2*2
const unsigned short brinTiles[32*2]=
{
    // tile 0 : azul
	0x0000, 0x0000, 
    0x0000, 0x0000,
    0x0000, 0x0000, 
    0x0000, 0x0000,
    0x0000, 0x0000,
    0x0000, 0x0000,
    0x0000, 0x0000,
    0x0000, 0x0000,

    // tile 1 : rallita abajo
    0x1111, 0x1111, 
    0x1111, 0x1111, 
    0x1111, 0x1111, 
    0x1111, 0x1111, 
    0x1111, 0x1111, 
    0x2222, 0x2222,
    0x1111, 0x1111,
    0x1111, 0x1111,

	// tile 2
    0x3333, 0x3333,
    0x3333, 0x3333,
    0x3333, 0x3333,
    0x3333, 0x3333,
    0x3333, 0x3333,
    0x3333, 0x3333,
    0x3333, 0x3333,
    0x3333, 0x3333,
};

#define brinMapLen 4096
const unsigned short brinMap[2048]=
{
    // map row 0
	0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x0002, // 8 entries
	0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,
	0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,
	0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,
	// map row 1
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 2
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 3
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 4
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001, 
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 5
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 6
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 7
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,

	// map row 8
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001, // 8 entries
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 9
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 10
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 11
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 12
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001, 
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 13
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 14
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	// map row 15
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
	0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,
};

#define brinMapRowLen 64
const unsigned short brinMapRow[32]=
{
    // row de 32 entries (32*2 = 64 B)
	0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000, // 16 B
	0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,
	0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,
	0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,
};

void fill_background()
{
	for (int i = 0; i<32; ++i)
	{
		memcpy(&se_mem[30][i*16], brinMapRow, brinMapRowLen);
	}
}

int main()
{
    // Load palette
	//memcpy(pal_bg_mem, pueblecito_1Pal, pueblecito_1PalLen);
	memcpy(pal_bg_mem, pueblecito_1_pal, pueblecito_1_pal_len);
	// Load tiles into CBB 0
	memcpy(&tile_mem[0][0], pueblecito_1Tiles, pueblecito_1TilesLen);
	memcpy(&tile_mem[1][0], pueblecito_1_tiles, pueblecito_1_tiles_len);
	// Load map into SBB 30
	//memcpy(&se_mem[30][0], pueblecito_1Map, pueblecito_1MapLen);
	memcpy(&se_mem[30][0], pueblecito_1_map, pueblecito_1_map_len);

	//fill_background();

    // set up BG0 for a 8bpp 32x32t map, using
	//   using charblock 0 and screenblock 31
	REG_BG0CNT= BG_CBB(1) | BG_SBB(30) | BG_8BPP | BG_REG_32x32;
	REG_DISPCNT= DCNT_MODE0 | DCNT_BG0;

    int a = 0;

    // Scroll around some
	int x= 0, y= 0;
	while(1)
	{
		vid_vsync();
		key_poll();

		x += key_tri_horz();
		y += key_tri_vert();

		REG_BG0HOFS= x;
		REG_BG0VOFS= y;
	}

    return 0;
}